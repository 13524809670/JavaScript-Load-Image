(function(e){"use strict";var t=function(e,a,r){var n,i,c=document.createElement("img");if(c.onerror=a,c.onload=function(){!i||r&&r.noRevoke||t.revokeObjectURL(i),a&&a(t.scale(c,r))},t.isInstanceOf("Blob",e)||t.isInstanceOf("File",e))n=i=t.createObjectURL(e),c._type=e.type;else{if("string"!=typeof e)return!1;n=e,r&&r.crossOrigin&&(c.crossOrigin=r.crossOrigin)}return n?(c.src=n,c):t.readFile(e,function(e){var t=e.target;t&&t.result?c.src=t.result:a&&a(e)})},a=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},t.transformCoordinates=function(e,t){var a=e.getContext("2d"),r=e.width,n=e.height;switch(t>4&&(e.width=n,e.height=r),t){case 2:a.translate(r,0),a.scale(-1,1);break;case 3:a.translate(r,n),a.rotate(Math.PI);break;case 4:a.translate(0,n),a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI),a.translate(0,-n);break;case 7:a.rotate(.5*Math.PI),a.translate(r,-n),a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-r,0)}},t.detectSubsampling=function(e){var t,a;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,a=t.getContext("2d"),a.drawImage(e,-e.width+1,0),0===a.getImageData(0,0,1,1).data[3]):!1},t.detectVerticalSquash=function(e,t){var a,r,n,i,c,o=document.createElement("canvas"),s=o.getContext("2d");for(o.width=1,o.height=t,s.drawImage(e,0,0),a=s.getImageData(0,0,1,t).data,r=0,n=t,i=t;i>r;)c=a[4*(i-1)+3],0===c?n=i:r=i,i=n+r>>1;return i/t||1},t.renderImageToCanvas=function(e,a,r,n,i,c,o,s,d,h){var g,l,u,m=e.getContext("2d"),f=document.createElement("canvas"),w=f.width=f.height=1024,v=f.getContext("2d");for(m.save(),t.detectSubsampling(a)&&(i/=2,c/=2),g=t.detectVerticalSquash(a,c),d=Math.ceil(w*d/i),h=Math.ceil(w*h/c/g),s=0,u=0;c>u;){for(o=0,l=0;i>l;)v.clearRect(0,0,w,w),v.drawImage(a,r,n,i,c,-l,-u,i,c),m.drawImage(f,0,0,w,w,o,s,d,h),l+=w,o+=d;u+=w,s+=h}m.restore()},t.scale=function(e,a){a=a||{};var r,n,i,c,o,s,d,h=document.createElement("canvas"),g=e.getContext||(a.canvas||a.crop)&&h.getContext,l=e.width,u=e.height,m=l,f=u,w=0,v=0,b=0,R=0;return g&&a.orientation>4?(r=a.maxHeight,n=a.maxWidth,i=a.minHeight,c=a.minWidth):(r=a.maxWidth,n=a.maxHeight,i=a.minWidth,c=a.minHeight),g&&r&&n&&a.crop?(o=r,s=n,r/n>l/u?(f=n*l/r,v=(u-f)/2):(m=r*u/n,w=(l-m)/2)):(o=l,s=u,d=Math.max((i||o)/o,(c||s)/s),d>1&&(o=Math.ceil(o*d),s=Math.ceil(s*d)),d=Math.min((r||o)/o,(n||s)/s),1>d&&(o=Math.ceil(o*d),s=Math.ceil(s*d))),g?(h.width=o,h.height=s,t.transformCoordinates(h,a.orientation),"image/jpeg"===e._type?t.renderImageToCanvas(h,e,w,v,m,f,b,R,o,s):h.getContext("2d").drawImage(e,w,v,m,f,b,R,o,s),h):(e.width=o,e.height=s,e)},t.createObjectURL=function(e){return a?a.createObjectURL(e):!1},t.revokeObjectURL=function(e){return a?a.revokeObjectURL(e):!1},t.readFile=function(e,t,a){if(window.FileReader&&FileReader.prototype.readAsDataURL){var r=new FileReader;return r.onload=r.onerror=t,a=a||"readAsDataURL",r[a]?(r[a](e),r):!1}return!1},"function"==typeof define&&define.amd?define(function(){return t}):e.loadImage=t})(this);